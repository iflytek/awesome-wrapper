此部分代码魔改自官方sdk。。。